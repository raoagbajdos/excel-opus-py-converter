<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBA to Python Converter</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <header role="banner">
            <div class="header-top">
                <button class="btn btn-secondary btn-small" id="shortcutsHelpBtn" title="Keyboard shortcuts (?)" aria-label="Show keyboard shortcuts">‚å®Ô∏è Shortcuts</button>
                <button class="theme-toggle" id="themeToggle" title="Toggle light/dark mode" aria-label="Toggle light or dark theme">üåô</button>
            </div>
            <h1>üêç VBA to Python Converter</h1>
            <p class="subtitle">Upload Excel files to extract VBA macros, formulas, and data ‚Äî convert everything to Python</p>
        </header>

        <main id="main-content">
            <!-- Upload Section -->
            <section class="upload-section" aria-label="File upload">
                <div class="upload-box" id="dropZone" role="button" tabindex="0" aria-label="Upload area: drag and drop an Excel file or click to browse">
                    <div class="upload-icon" aria-hidden="true">üìÅ</div>
                    <h3>Drag & Drop Excel File</h3>
                    <p>or click to browse</p>
                    <p class="file-types">Supported: .xlsm, .xls, .xlsb, .xlsx, .xla, .xlam</p>
                    <input type="file" id="fileInput" accept=".xlsm,.xls,.xlsb,.xlsx,.xla,.xlam" hidden>
                </div>
                <div id="currentFileIndicator" class="current-file-indicator hidden">
                    üìé Current file: <strong id="currentFileName"></strong>
                    <span class="file-hint">(will be used automatically in all sections below)</span>
                </div>
                <div id="uploadStatus" class="status-message hidden" role="alert" aria-live="polite"></div>
            </section>

            <!-- Modules List -->
            <section class="modules-section hidden" id="modulesSection" aria-label="Extracted VBA modules">
                <div class="section-header">
                    <h2>üìã Extracted VBA Modules</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="convertAllBtn" aria-label="Convert All to Python">üîÑ Convert All to Python</button>
                        <button class="btn btn-secondary hidden" id="downloadAllZipBtn" aria-label="Download All as ZIP">üì¶ Download All as ZIP</button>
                    </div>
                </div>
                <div class="modules-list" id="modulesList"></div>
            </section>

            <!-- Conversion Options (always visible) -->
            <section class="options-section collapsible" id="optionsSection" aria-label="Conversion options">
                <div class="section-header">
                    <h3>‚öôÔ∏è Conversion Options</h3>
                    <button class="btn btn-secondary btn-icon collapse-toggle" data-target="optionsBody" aria-label="Toggle conversion options" aria-expanded="true">‚ñº</button>
                </div>
                <div class="collapsible-body" id="optionsBody">
                <div class="options-grid">
                    <div class="option-group">
                        <label for="targetLibrary">Target Library:</label>
                        <select id="targetLibrary">
                            <option value="pandas">pandas</option>
                            <option value="polars">polars</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="providerSelect">Conversion Engine:</label>
                        <select id="providerSelect">
                            <option value="offline" selected>‚ö° Offline (no API key)</option>
                            <option value="anthropic">ü§ñ Anthropic Claude</option>
                            <option value="openai">ü§ñ OpenAI GPT</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="includeTypeHints" checked>
                            Include Type Hints
                        </label>
                    </div>
                </div>
                </div>
            </section>

            <!-- Code Comparison View -->
            <section class="comparison-section hidden" id="comparisonSection" aria-label="Code conversion comparison">
                <div class="section-header">
                    <h2>üîÑ Code Conversion</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-small" id="toggleDiffBtn" aria-label="Highlights On" aria-pressed="true">üîç Highlights On</button>
                        <button class="btn btn-secondary" id="copyPythonBtn" aria-label="Copy Python">üìã Copy Python</button>
                        <button class="btn btn-primary" id="downloadPythonBtn" aria-label="Download .py">‚¨áÔ∏è Download .py</button>
                    </div>
                </div>

                <!-- Module Navigator Tabs (shown after batch convert) -->
                <div class="module-tabs hidden" id="moduleTabs">
                    <div class="module-tabs-scroll" id="moduleTabsList"></div>
                    <div class="module-tabs-nav">
                        <button class="tab-nav-btn" id="prevModuleBtn" title="Previous module" aria-label="Previous module">‚óÄ</button>
                        <span class="tab-counter" id="tabCounter" aria-live="polite">1 / 1</span>
                        <button class="tab-nav-btn" id="nextModuleBtn" title="Next module" aria-label="Next module">‚ñ∂</button>
                    </div>
                </div>
                
                <div class="code-panels" id="codePanels">
                    <section class="code-panel vba-panel" aria-label="VBA source code">
                        <div class="panel-header">
                            <span class="panel-title">VBA Code</span>
                            <div class="panel-header-right">
                                <span class="code-stats" id="vbaStats"></span>
                                <span class="module-name" id="vbaModuleName"></span>
                                <button class="btn btn-secondary btn-icon" id="copyVbaBtn" title="Copy VBA code" aria-label="Copy VBA code to clipboard">üìã</button>
                            </div>
                        </div>
                        <pre><code class="language-vbnet" id="vbaCode"></code></pre>
                    </section>
                    
                    <div class="panel-resize-handle" id="panelResizeHandle" role="separator" aria-label="Drag to resize code panels" tabindex="0"></div>

                    <section class="code-panel python-panel" aria-label="Converted Python code">
                        <div class="panel-header">
                            <span class="panel-title">Python Code</span>
                            <div class="panel-header-right">
                                <span class="code-stats" id="pythonStats"></span>
                                <span class="status-badge" id="conversionStatus"></span>
                            </div>
                        </div>
                        <pre><code class="language-python" id="pythonCode"></code></pre>
                    </section>
                </div>

                <!-- Conversion Notes -->
                <div class="notes-section hidden" id="notesSection">
                    <h4>üìù Conversion Notes</h4>
                    <ul id="conversionNotes"></ul>
                </div>
            </section>

            <!-- Paste VBA Section -->
            <section class="paste-section collapsible" aria-label="Paste VBA code">
                <div class="section-header">
                    <h2>‚úèÔ∏è Or Paste VBA Code Directly</h2>
                    <button class="btn btn-secondary btn-icon collapse-toggle" data-target="pasteBody" aria-label="Toggle paste section" aria-expanded="true">‚ñº</button>
                </div>
                <div class="collapsible-body" id="pasteBody">
                <div class="paste-area">
                    <textarea id="vbaInput" aria-label="VBA code input" placeholder="Paste your VBA code here...

Example:
Sub CalculateTotal()
    Dim ws As Worksheet
    Dim total As Double
    
    Set ws = ThisWorkbook.Worksheets(&quot;Sheet1&quot;)
    total = Application.WorksheetFunction.Sum(ws.Range(&quot;A1:A10&quot;))
    MsgBox &quot;Total: &quot; &amp; total
End Sub"></textarea>
                    <div class="paste-toolbar">
                        <div class="syntax-validation" id="syntaxValidation">
                            <span class="validation-icon" id="validationIcon">‚¨ú</span>
                            <span class="validation-text" id="validationText">Paste VBA code above</span>
                        </div>
                        <button class="btn btn-primary" id="convertPastedBtn" aria-label="Convert to Python">Convert to Python</button>
                    </div>
                </div>
                </div>
            </section>

            <!-- Formula Extraction Section -->
            <section class="formulas-section collapsible" aria-label="Excel formula extraction">
                <div class="section-header">
                    <h2>üî¢ Excel Formula Converter</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-icon collapse-toggle" data-target="formulasBody" aria-label="Toggle formula section" aria-expanded="true">‚ñº</button>
                    </div>
                </div>
                <div class="collapsible-body" id="formulasBody">
                    <p class="subtitle-small">Extract and convert Excel formulas to Python</p>
                <div class="formula-upload">
                    <button class="btn btn-primary" id="extractFormulasBtn">
                        üìä Extract Formulas
                    </button>
                    <input type="file" id="formulaFileInput" accept=".xlsm,.xls,.xlsb,.xla,.xlam,.xlsx" hidden>
                </div>
                <div class="formula-results hidden" id="formulaResults">
                    <h3>Extracted Formulas</h3>
                    <div class="formula-stats" id="formulaStats"></div>
                    <div class="formula-list" id="formulaList"></div>
                </div>
                </div>
            </section>

            <!-- Data Export Section -->
            <section class="data-export-section collapsible" aria-label="Data export to Python">
                <div class="section-header">
                    <h2>üì§ Data Export to Python</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-icon collapse-toggle" data-target="dataExportBody" aria-label="Toggle data export section" aria-expanded="true">‚ñº</button>
                    </div>
                </div>
                <div class="collapsible-body" id="dataExportBody">
                    <p class="subtitle-small">Export Excel data as pandas DataFrames</p>
                <div class="data-export-upload">
                    <button class="btn btn-primary" id="exportDataBtn">
                        üì• Export Data
                    </button>
                    <input type="file" id="dataFileInput" accept=".xlsm,.xls,.xlsb,.xlsx" hidden>
                </div>
                <div class="data-results hidden" id="dataResults">
                    <h3>Exported Data</h3>
                    <div class="data-code-panel">
                        <div class="panel-header">
                            <span class="panel-title">Generated Python Code</span>
                            <button class="btn btn-secondary" id="copyDataCodeBtn">üìã Copy Code</button>
                        </div>
                        <pre><code class="language-python" id="dataCode"></code></pre>
                    </div>
                    <div class="data-metadata" id="dataMetadata"></div>
                </div>
                </div>
            </section>

            <!-- Complete Workbook Analysis Section -->
            <section class="analysis-section collapsible" aria-label="Workbook analysis">
                <div class="section-header">
                    <h2>üîç Complete Workbook Analysis</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-icon collapse-toggle" data-target="analysisBody" aria-label="Toggle analysis section" aria-expanded="true">‚ñº</button>
                    </div>
                </div>
                <div class="collapsible-body" id="analysisBody">
                    <p class="subtitle-small">Analyze VBA + Formulas + Data and generate comprehensive Python script</p>
                <div class="analysis-upload">
                    <button class="btn btn-primary" id="analyzeWorkbookBtn">
                        üöÄ Analyze Complete Workbook
                    </button>
                    <p class="upload-hint" id="analysisHint">Upload a file above first, or click to select a new file</p>
                    <input type="file" id="analysisFileInput" accept=".xlsm,.xls,.xlsb,.xlsx,.xla,.xlam" hidden>
                </div>
                <div class="analysis-results hidden" id="analysisResults">
                    <h3>Workbook Analysis Report</h3>
                    <div class="analysis-summary" id="analysisSummary"></div>
                    <div class="analysis-code-panel">
                        <div class="panel-header">
                            <span class="panel-title">Complete Python Script</span>
                            <button class="btn btn-secondary" id="copyAnalysisCodeBtn">üìã Copy Code</button>
                        </div>
                        <pre><code class="language-python" id="analysisCode"></code></pre>
                    </div>
                    <div class="analysis-report">
                        <h4>Detailed Report</h4>
                        <pre id="analysisReport"></pre>
                    </div>
                </div>
                </div>
            </section>

            <!-- Conversion History Panel -->
            <section class="history-section" id="historySection" aria-label="Conversion history">
                <div class="section-header">
                    <h2>üìú Conversion History</h2>
                    <div class="header-actions">
                        <span class="history-count" id="historyCount">0 conversions</span>
                        <button class="btn btn-secondary btn-small" id="exportHistoryBtn" title="Export history" aria-label="Export">üì§ Export</button>
                        <label class="btn btn-secondary btn-small" id="importHistoryLabel" title="Import history">
                            üì• Import
                            <input type="file" id="importHistoryInput" accept=".json,.csv" hidden>
                        </label>
                        <button class="btn btn-secondary btn-small" id="clearHistoryBtn" aria-label="Clear">üóëÔ∏è Clear</button>
                        <button class="btn btn-secondary btn-small" id="toggleHistoryBtn" aria-label="Toggle history panel">‚ñº</button>
                    </div>
                </div>
                <div class="history-filters" id="historyFilters">
                    <input type="text" class="history-search" id="historySearch" placeholder="üîç Search modules..." aria-label="Search conversion history">
                    <select class="history-engine-filter" id="historyEngineFilter" aria-label="Filter by conversion engine">
                        <option value="all">All engines</option>
                        <option value="offline">‚ö° Offline</option>
                        <option value="anthropic">ü§ñ Anthropic</option>
                        <option value="openai">ü§ñ OpenAI</option>
                    </select>
                    <select class="history-status-filter" id="historyStatusFilter" aria-label="Filter by conversion result">
                        <option value="all">All results</option>
                        <option value="success">‚úÖ Success</option>
                        <option value="failed">‚ùå Failed</option>
                    </select>
                </div>
                <div class="history-list" id="historyList">
                    <p class="history-empty">No conversions yet. Convert some VBA code to see history here.</p>
                </div>
            </section>
        </main>

        <footer role="contentinfo">
            <p>Powered by Claude AI ‚Ä¢ Built with FastAPI & Python</p>
        </footer>
    </div>

    <!-- Keyboard Shortcuts Overlay -->
    <div class="shortcuts-overlay hidden" id="shortcutsOverlay" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts">
        <div class="shortcuts-panel">
            <div class="shortcuts-header">
                <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                <button class="btn btn-secondary btn-small" id="closeShortcutsBtn" aria-label="Close shortcuts panel">‚úï</button>
            </div>
            <div class="shortcuts-body">
                <div class="shortcut-group">
                    <h4>Conversion</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Enter</kbd><span>Convert pasted VBA code</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd><span>Convert all modules</span></div>
                </div>
                <div class="shortcut-group">
                    <h4>Files</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>S</kbd><span>Download Python file</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>O</kbd><span>Open file browser</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd><span>Download all as ZIP</span></div>
                </div>
                <div class="shortcut-group">
                    <h4>Clipboard</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd><span>Copy Python code</span></div>
                </div>
                <div class="shortcut-group">
                    <h4>Navigation</h4>
                    <div class="shortcut-row"><kbd>Alt</kbd>+<kbd>‚Üê</kbd><span>Previous module tab</span></div>
                    <div class="shortcut-row"><kbd>Alt</kbd>+<kbd>‚Üí</kbd><span>Next module tab</span></div>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>H</kbd><span>Toggle diff highlights</span></div>
                </div>
                <div class="shortcut-group">
                    <h4>General</h4>
                    <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>D</kbd><span>Toggle dark/light theme</span></div>
                    <div class="shortcut-row"><kbd>?</kbd><span>Show/hide this panel</span></div>
                    <div class="shortcut-row"><kbd>Esc</kbd><span>Close overlays</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay" role="dialog" aria-modal="true" aria-label="Processing">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p id="loadingMessage" aria-live="assertive">Converting...</p>
        <div class="batch-progress hidden" id="batchProgress">
            <div class="batch-progress-bar">
                <div class="batch-progress-fill" id="batchProgressFill"></div>
            </div>
            <span class="batch-progress-text" id="batchProgressText">0 / 0 modules</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-vbnet.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
